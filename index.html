<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART RACING PRO - ÌÜµÌï© Î∂ÑÏÑù ÏãúÏä§ÌÖú</title>
    
    <!-- ÌïÑÏàò ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@0.294.0/dist/umd/lucide-react.min.js"></script>

    <!-- Firebase SDK (Ìò∏ÌôòÏÑ± ÎÜíÏùÄ Î≤ÑÏ†Ñ) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ÌôòÍ≤Ω Î≥ÄÏàò ÎòêÎäî Í∏∞Î≥∏Í∞í Ï≤òÎ¶¨
        const configStr = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        const firebaseConfig = JSON.parse(configStr);
        
        // Ïï± Ï¥àÍ∏∞Ìôî
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'racing-pro-final-v9';
        const initialToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Ï†ÑÏó≠ Í∞ùÏ≤¥Î°ú ÎÖ∏Ï∂ú (React Ïª¥Ìè¨ÎÑåÌä∏ÏóêÏÑú ÏÇ¨Ïö©)
        window.fb = { auth, db, appId, initialToken, doc, setDoc, onSnapshot, signInAnonymously, signInWithCustomToken, onAuthStateChanged };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; margin: 0; }
        
        /* ÎßàÎ≤àÎ≥Ñ Í≥µÏãù ÏÉâÏÉÅ */
        .h-1 { @apply bg-white text-gray-900 border-2 border-gray-300; }
        .h-2 { @apply bg-yellow-400 text-gray-900 border-none; }
        .h-3 { @apply bg-red-600 text-white border-none; }
        .h-4 { @apply bg-gray-900 text-white border-none; }
        .h-5 { @apply bg-blue-600 text-white border-none; }
        .h-6 { @apply bg-green-600 text-white border-none; }
        .h-7 { @apply bg-amber-800 text-white border-none; }
        .h-8 { @apply bg-pink-400 text-white border-none; }
        .h-9 { @apply bg-purple-600 text-white border-none; }
        .h-10 { @apply bg-sky-300 text-gray-900 border-none; }
        .h-11 { @apply bg-white text-green-700 border-4 border-green-600; }
        .h-12 { @apply bg-yellow-400 text-green-700 border-4 border-green-600; }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .animate-in { animation: slideUp 0.4s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { Trophy, Calendar, Upload, Cloud, Save, MapPin, Clock, Info, ChevronDown, ChevronUp, Search, Zap, Star, Flame, FileText } = lucide;

        // --- 1. Îç∞Ïù¥ÌÑ∞ ÌååÏã± ÏóîÏßÑ (Parser) ---
        const Parser = {
            // Ï∂úÏ†ÑÌëú ÌååÏã±
            entry: (text) => {
                const lines = text.split('\n');
                const races = [];
                let current = null;
                let isTable = false;

                lines.forEach(line => {
                    const t = line.trim();
                    if (!t) return;
                    // Í≤ΩÏ£º Ìó§Îçî (Ïòà: Ï†ú1Í≤ΩÏ£º ...)
                    if (t.includes('Ï†ú') && t.includes('Í≤ΩÏ£º') && (t.includes('ÏÑúÏö∏') || t.includes('Î∂ÄÏÇ∞') || t.includes('Î∂ÄÍ≤Ω'))) {
                        if (current) races.push(current);
                        const no = (t.match(/Ï†ú(\d+)Í≤ΩÏ£º/) || [])[1] || '?';
                        const dist = (t.match(/(\d{3,4})M/i) || [])[1] || '';
                        // ÏãúÍ∞Ñ Ï∂îÏ∂ú (xx:xx ÌòïÏãù)
                        const timeMatch = t.match(/(\d{1,2}:\d{2})/);
                        const time = timeMatch ? timeMatch[1] : '';
                        current = { no, distance: dist, startTime: time, horses: [] };
                        isTable = false;
                        return;
                    }
                    if (t.startsWith('Î≤àÌò∏')) { isTable = true; return; }
                    if (current && isTable) {
                        const cols = t.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        if (cols.length > 5) {
                            current.horses.push({
                                no: cols[0]?.replace(/[‚ñ≤*]/g, ''),
                                name: cols[1]?.trim(),
                                origin: cols[2], sex: cols[3], age: cols[4],
                                rating: cols[5], weight: cols[6]?.replace('*',''), weightDiff: cols[7],
                                jockey: cols[8], trainer: cols[9], 
                                trainingCount: cols[11], cycle: cols[12],
                                gear: cols[13]?.replace(/"/g, ''), 
                                father: cols[15], grade: cols[16]
                            });
                        }
                    }
                });
                if (current) races.push(current);
                return races;
            },
            // ÏÉÅÏÑ∏ Ï†ÑÏ†Å ÌååÏã±
            history: (text) => {
                const lines = text.split('\n');
                return lines.slice(1).map(line => {
                    const c = line.split(',');
                    if (c.length < 20) return null;
                    return {
                        horseName: c[6]?.trim(),
                        date: c[12], dist: c[14]?.replace('M',''), 
                        rec: c[15], rank: c[16], 
                        s1f: c[23], g1f: c[25]
                    };
                }).filter(Boolean);
            },
            // Ï†ÑÎ¨∏Í∞Ä ÌîΩ ÌååÏã±
            expert: (text) => {
                const result = { seoul: {}, busan: {} };
                const chunks = text.split(/\*\*(ÏÑúÏö∏|Î∂ÄÏÇ∞|Î∂ÄÍ≤Ω)\s*(\d+)Í≤ΩÏ£º/);
                for (let i = 1; i < chunks.length; i += 3) {
                    const loc = (chunks[i] === 'ÏÑúÏö∏') ? 'seoul' : 'busan';
                    const no = chunks[i+1];
                    const content = chunks[i+2] || '';
                    
                    // Ï∂îÏ≤ú ÎßàÎ≤à
                    const recMatch = content.match(/\*\*Ï∂îÏ≤ú.*?\*\*[:Ôºö]\s*(.+?)(?=\r?\n|$)/);
                    const recommended = [];
                    if (recMatch) {
                        const matches = recMatch[1].matchAll(/\((\d+)\)\s*([Í∞Ä-Ìû£A-Z]+)/g);
                        for (const m of matches) recommended.push({ no: m[1], name: m[2] });
                    }

                    // Î≥µÎ≥ë/ÏÑ†Ìñâ
                    const dark = (content.match(/\*\*Î≥µÎ≥ë.*?\*\*[:Ôºö]\s*([\d, ]+)/) || [])[1]?.split(',').map(s=>s.trim()).filter(Boolean) || [];
                    const lead = (content.match(/\*\*ÏÑ†Ìñâ.*?\*\*[:Ôºö]\s*([\d, ]+)/) || [])[1]?.split(',').map(s=>s.trim()).filter(Boolean) || [];

                    // ÎßàÌïÑÎ≥Ñ ÏÉÅÏÑ∏ ÏΩîÎ©òÌä∏
                    const horseComments = {};
                    const cMatch = content.matchAll(/\*\*\s*\((\d+)\)\s*([Í∞Ä-Ìû£A-Z\s()]+)\s*\*\*\s*ÏùÄ?(.+?)(?=\s*(?:\r?\n\r?\n|\*\*\(|\*\*Ï∂îÏ≤ú|\*\*Î≥µÎ≥ë|\*\*ÏÑ†Ìñâ|$))/gs);
                    for (const m of cMatch) horseComments[m[1]] = m[3].trim().replace(/\s+/g, ' ');

                    // Ï†ÑÏ≤¥ Ìèâ
                    const summary = content.split('\n').find(l => l.trim() && !l.startsWith('**') && !l.includes('Îì±Í∏â')) || "";

                    result[loc][no] = { recommended, dark, lead, horseComments, summary };
                }
                return result;
            }
        };

        // --- ÎßàÎ≤à Ïä§ÌÉÄÏùº ---
        const getBadgeStyle = (no) => {
            const n = parseInt(no);
            if (n===1) return "h-1"; if (n===2) return "h-2"; if (n===3) return "h-3";
            if (n===4) return "h-4"; if (n===5) return "h-5"; if (n===6) return "h-6";
            if (n===7) return "h-7"; if (n===8) return "h-8"; if (n===9) return "h-9";
            if (n===10) return "h-10"; if (n===11) return "h-11"; if (n===12) return "h-12";
            return "bg-gray-200 text-gray-500";
        };

        // --- 2. Î©îÏù∏ App Ïª¥Ìè¨ÎÑåÌä∏ ---
        function App() {
            const [user, setUser] = useState(null);
            const [status, setStatus] = useState('connecting');
            const [view, setView] = useState('view');
            const [loc, setLoc] = useState('seoul');
            const [date, setDate] = useState('2025-12-28');
            const [raceIdx, setRaceIdx] = useState(0);
            const [expanded, setExpanded] = useState(null);

            const [dbData, setDbData] = useState({
                seoul: { races: [], histories: [], analysis: { races: {} }, expert: {} },
                busan: { races: [], histories: [], analysis: { races: {} }, expert: {} }
            });

            // Firebase Ïù∏Ï¶ù Î∞è Îç∞Ïù¥ÌÑ∞ Î°úÎìú (ÎÇ†ÏßúÎ≥Ñ)
            useEffect(() => {
                const { auth, db, appId, initialToken, doc, onSnapshot, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = window.fb;
                
                const initAuth = async () => {
                    try {
                        if (initialToken) await signInWithCustomToken(auth, initialToken);
                        else await signInAnonymously(auth);
                        
                        onAuthStateChanged(auth, (u) => {
                            setUser(u);
                            if (u) {
                                // Í≤ΩÎ°ú: dailyRacing Ïª¨Î†âÏÖò -> ÎÇ†Ïßú Î¨∏ÏÑú
                                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'dailyRacing', date);
                                onSnapshot(docRef, (snap) => {
                                    if (snap.exists()) {
                                        setDbData(snap.data());
                                        setStatus('synced');
                                    } else {
                                        // Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå -> Ï¥àÍ∏∞Ìôî
                                        setDbData({
                                            seoul: { races: [], histories: [], analysis: { races: {} }, expert: {} },
                                            busan: { races: [], histories: [], analysis: { races: {} }, expert: {} }
                                        });
                                        setStatus('empty');
                                    }
                                });
                            }
                        });
                    } catch (err) { setStatus('error'); }
                };
                initAuth();
            }, [date]);

            // Îç∞Ïù¥ÌÑ∞ ÏÑúÎ≤Ñ Ï†ÄÏû•
            const saveToCloud = async () => {
                if (!user) return;
                const { db, appId, doc, setDoc } = window.fb;
                setStatus('saving');
                try {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'dailyRacing', date);
                    await setDoc(docRef, { ...dbData, lastUpdated: new Date().toISOString() });
                    setStatus('synced');
                    alert(`‚úÖ ${date} Îç∞Ïù¥ÌÑ∞Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.`);
                } catch (e) {
                    alert("Ï†ÄÏû• Ïã§Ìå®: " + e.message);
                    setStatus('error');
                }
            };

            const handleFileUpload = (e, type, location) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const text = ev.target.result;
                    setDbData(prev => {
                        const next = JSON.parse(JSON.stringify(prev));
                        if (type === 'entry') next[location].races = Parser.entry(text);
                        if (type === 'history') next[location].histories = Parser.history(text);
                        if (type === 'analysis') next[location].analysis = JSON.parse(text);
                        if (type === 'expert') {
                            const p = Parser.expert(text);
                            next.seoul.expert = p.seoul;
                            next.busan.expert = p.busan;
                        }
                        return next;
                    });
                    setStatus('modified');
                };
                reader.readAsText(file, 'UTF-8');
            };

            const current = dbData[loc];
            const race = current?.races[raceIdx];
            const expertInfo = current?.expert?.[race?.no];
            const analysisInfo = current?.analysis?.races?.[race?.no];

            return (
                <div className="max-w-2xl mx-auto min-h-screen flex flex-col bg-slate-50 relative shadow-2xl">
                    {/* ÏÉÅÎã® Ìó§Îçî */}
                    <header className="bg-slate-900 text-white p-5 sticky top-0 z-50 shadow-lg">
                        <div className="flex justify-between items-center mb-4">
                            <div className="flex items-center gap-2">
                                <Trophy className="text-yellow-400" size={20}/>
                                <h1 className="text-lg font-black italic tracking-tighter">SMART <span className="text-yellow-400">PRO</span></h1>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setView('view')} className={`px-4 py-1.5 rounded text-xs font-bold ${view === 'view' ? 'bg-white text-slate-900' : 'text-slate-400 bg-slate-800'}`}>Í≤ΩÎßàÏßÄ</button>
                                <button onClick={() => setView('admin')} className={`px-4 py-1.5 rounded text-xs font-bold ${view === 'admin' ? 'bg-indigo-600' : 'text-slate-400 bg-slate-800'}`}>Í¥ÄÎ¶¨</button>
                            </div>
                        </div>
                        <div className="flex gap-2 items-center bg-slate-800 p-2 rounded-xl">
                            <Calendar size={16} className="text-slate-400 ml-2"/>
                            <input type="date" value={date} onChange={(e) => setDate(e.target.value)} className="bg-transparent text-sm font-bold text-white outline-none w-32"/>
                            <div className="h-4 w-px bg-slate-600 mx-1"></div>
                            <div className="flex-1 flex gap-1">
                                <button onClick={() => setLoc('seoul')} className={`flex-1 py-1.5 rounded-lg text-xs font-bold ${loc === 'seoul' ? 'bg-slate-100 text-slate-900' : 'text-slate-500'}`}>ÏÑúÏö∏</button>
                                <button onClick={() => setLoc('busan')} className={`flex-1 py-1.5 rounded-lg text-xs font-bold ${loc === 'busan' ? 'bg-blue-600 text-white' : 'text-slate-500'}`}>Î∂ÄÏÇ∞</button>
                            </div>
                        </div>
                        <div className="text-[10px] text-center mt-2 text-slate-500 font-bold uppercase tracking-widest flex justify-center items-center gap-2">
                            <Cloud size={10}/> Status: {status.toUpperCase()}
                        </div>
                    </header>

                    <main className="flex-1 p-4 overflow-y-auto pb-20">
                        {view === 'admin' ? (
                            <div className="space-y-4 animate-in">
                                <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="font-black text-lg flex items-center gap-2 text-slate-800"><Upload size={18} className="text-indigo-600"/> Îç∞Ïù¥ÌÑ∞ ÏóÖÎ°úÎìú</h3>
                                        {status === 'modified' && (
                                            <button onClick={saveToCloud} className="bg-orange-600 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg flex items-center gap-2 animate-bounce">
                                                <Save size={14}/> ÏÑúÎ≤Ñ Ï†ÄÏû•
                                            </button>
                                        )}
                                    </div>
                                    
                                    <div className="grid grid-cols-1 gap-3">
                                        {[
                                            { id: 'entry', label: '1. Ï∂úÏ†ÑÌëú (CSV)' },
                                            { id: 'history', label: '2. Ï†ÑÏ†Å (CSV)' },
                                            { id: 'analysis', label: '3. AI Î∂ÑÏÑù (JSON)' },
                                            { id: 'expert', label: '4. Ï†ÑÎ¨∏Í∞Ä ÌîΩ (TXT)' }
                                        ].map(item => (
                                            <div key={item.id} className="p-3 bg-slate-50 rounded-xl border border-slate-200">
                                                <label className="text-xs font-bold text-slate-500 block mb-1">{item.label}</label>
                                                <input type="file" onChange={e => handleFileUpload(e, item.id, loc)} className="text-xs w-full"/>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {/* Í≤ΩÏ£º Î≤àÌò∏ ÌÉ≠ */}
                                <div className="flex overflow-x-auto gap-2 pb-2 scrollbar-hide">
                                    {current?.races.length > 0 ? current.races.map((r, i) => (
                                        <button key={i} onClick={() => {setRaceIdx(i); setExpanded(null);}} className={`flex-shrink-0 w-14 h-14 rounded-2xl font-black text-lg transition-all shadow-sm border ${raceIdx === i ? 'bg-slate-900 text-white border-slate-900 scale-105' : 'bg-white text-slate-300 border-slate-100'}`}>
                                            {r.no}
                                        </button>
                                    )) : <div className="w-full py-10 text-center text-slate-300 font-bold border-2 border-dashed rounded-3xl">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>}
                                </div>

                                {race && (
                                    <div className="space-y-4 animate-in">
                                        {/* Í≤ΩÏ£º Ï†ïÎ≥¥ Ïπ¥Îìú */}
                                        <div className="bg-white p-6 rounded-[2.5rem] shadow-sm border-l-8 border-yellow-400 relative overflow-hidden">
                                            <div className="flex justify-between items-start relative z-10">
                                                <div>
                                                    <h2 className="text-3xl font-black text-slate-900 italic tracking-tighter">Ï†ú {race.no} Í≤ΩÏ£º</h2>
                                                    <div className="flex items-center gap-2 text-xs font-bold text-slate-400 mt-2">
                                                        <Clock size={14}/> {race.startTime}
                                                        <span className="w-1 h-1 bg-slate-300 rounded-full"/>
                                                        <span className="text-indigo-600 bg-indigo-50 px-2 rounded font-black">{race.distance}M</span>
                                                    </div>
                                                </div>
                                                {analysisInfo?.avgRecord && (
                                                    <div className="text-right">
                                                        <span className="text-[10px] font-bold text-slate-400 uppercase">Avg Rec</span>
                                                        <div className="text-2xl font-black text-slate-800 font-mono tracking-tight">{analysisInfo.avgRecord}</div>
                                                    </div>
                                                )}
                                            </div>
                                            
                                            {expertInfo && (
                                                <div className="mt-4 p-4 bg-orange-50 rounded-2xl border border-orange-100 relative">
                                                    <div className="flex flex-wrap gap-2 items-center mb-2">
                                                        <span className="bg-orange-600 text-white text-[9px] px-2 py-0.5 rounded-full font-black uppercase flex items-center gap-1"><Trophy size={10}/> Expert</span>
                                                        <div className="flex gap-1 ml-auto">
                                                            {expertInfo.recommended?.map(h => (
                                                                <span key={h.no} className="w-6 h-6 rounded-full bg-white text-orange-600 border border-orange-200 flex items-center justify-center text-xs font-black shadow-sm">{h.no}</span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    <p className="text-xs text-orange-900 font-medium leading-relaxed italic">
                                                        {expertInfo.summary ? expertInfo.summary.substring(0, 100) + "..." : "Ï†ÑÎ¨∏Í∞Ä ÏÉÅÏÑ∏ Î∂ÑÏÑù Ï∞∏Ï°∞"}
                                                    </p>
                                                    <div className="mt-2 pt-2 border-t border-orange-100 flex gap-3 text-[10px] font-bold">
                                                        {expertInfo.dark.length > 0 && <span className="text-purple-600">‚ö° Î≥µÎ≥ë: {expertInfo.dark.join(', ')}</span>}
                                                        {expertInfo.lead.length > 0 && <span className="text-red-600">üî• ÏÑ†Ìñâ: {expertInfo.lead.join(', ')}</span>}
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        {/* ÎßàÌïÑ Î¶¨Ïä§Ìä∏ */}
                                        <div className="flex flex-col gap-3 pb-10">
                                            {race.horses.map((h) => {
                                                const isExp = expanded === h.no;
                                                const hist = current.histories.filter(v => v.horseName === h.name).slice(0, 5);
                                                const expComment = expertInfo?.horseComments?.[h.no];
                                                
                                                const isRec = expertInfo?.recommended?.some(r => r.no === h.no);
                                                const isDark = expertInfo?.dark?.includes(h.no);
                                                const isLead = expertInfo?.lead?.includes(h.no);
                                                
                                                const isFastS = analysisInfo?.analysis?.fastStart.some(v => v.no === h.no);
                                                const isFastF = analysisInfo?.analysis?.fastFinish.some(v => v.no === h.no);

                                                return (
                                                    <div key={h.no} className={`bg-white rounded-2xl shadow-sm border overflow-hidden transition-all ${isExp ? 'border-indigo-500 ring-1 ring-indigo-500' : 'border-slate-100'}`}>
                                                        <div className="p-4 flex items-center gap-4 cursor-pointer" onClick={() => setExpanded(isExp ? null : h.no)}>
                                                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center shadow-inner font-black text-xl italic tracking-tighter ${getBadgeStyle(h.no)}`}>
                                                                {h.no}
                                                            </div>
                                                            <div className="flex-1 min-w-0">
                                                                <div className="flex items-center gap-2 mb-1">
                                                                    <h3 className="font-bold text-slate-800 truncate text-lg">{h.name}</h3>
                                                                    <div className="flex gap-1">
                                                                        {isRec && <Star size={12} className="text-orange-400 fill-orange-400" />}
                                                                        {isDark && <Zap size={12} className="text-purple-600 fill-purple-600" />}
                                                                        {isLead && <Flame size={12} className="text-red-500 fill-red-500" />}
                                                                        {isFastS && <div className="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"/>}
                                                                        {isFastF && <div className="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"/>}
                                                                    </div>
                                                                </div>
                                                                <div className="text-xs text-slate-500 flex gap-2 font-bold uppercase">
                                                                    <span className="text-indigo-600">{h.jockey}</span>
                                                                    <span className="text-slate-300">|</span>
                                                                    <span>{h.weight}kg</span>
                                                                    <span className="text-slate-300">|</span>
                                                                    <span className="bg-slate-100 px-1.5 rounded text-slate-600">R{h.rating}</span>
                                                                </div>
                                                            </div>
                                                            <div className="text-right pr-1">
                                                                <div className="text-[9px] text-slate-400 font-bold uppercase">Train</div>
                                                                <div className="font-black text-slate-800">{h.trainingCount}</div>
                                                            </div>
                                                            <div className="text-slate-300">
                                                                {isExp ? <ChevronUp size={20}/> : <ChevronDown size={20}/>}
                                                            </div>
                                                        </div>

                                                        {isExp && (
                                                            <div className="bg-slate-50 border-t border-slate-100 p-4 animate-in">
                                                                {/* Ï†ÑÎ¨∏Í∞Ä ÏΩîÎ©òÌä∏ */}
                                                                {expComment && (
                                                                    <div className="mb-4 bg-white p-3 rounded-xl border-l-4 border-orange-400 shadow-sm">
                                                                        <div className="flex items-center gap-2 mb-1 text-orange-600 font-black text-[10px] uppercase tracking-wider">
                                                                            <Zap size={10}/> Expert Insight
                                                                        </div>
                                                                        <p className="text-xs font-medium text-slate-700 leading-relaxed">
                                                                            {expComment}
                                                                        </p>
                                                                    </div>
                                                                )}

                                                                <div className="grid grid-cols-2 gap-2 mb-4 text-xs text-slate-600">
                                                                    <div className="bg-white p-2 rounded-lg border border-slate-200">
                                                                        <div className="text-[10px] text-slate-400 font-bold mb-1">Ï°∞ÍµêÏÇ¨</div>
                                                                        <div className="font-bold">{h.trainer}</div>
                                                                    </div>
                                                                    <div className="bg-white p-2 rounded-lg border border-slate-200">
                                                                        <div className="text-[10px] text-slate-400 font-bold mb-1">Î∂ÄÎßà</div>
                                                                        <div className="font-bold truncate">{h.father}</div>
                                                                    </div>
                                                                    <div className="bg-white p-2 rounded-lg border border-slate-200">
                                                                        <div className="text-[10px] text-slate-400 font-bold mb-1">Ï∂úÏ†ÑÏ£ºÍ∏∞</div>
                                                                        <div className="font-bold text-indigo-600">{h.cycle}Ï£º</div>
                                                                    </div>
                                                                    <div className="bg-white p-2 rounded-lg border border-slate-200">
                                                                        <div className="text-[10px] text-slate-400 font-bold mb-1">Ïû•Íµ¨</div>
                                                                        <div className="font-bold truncate">{h.gear || '-'}</div>
                                                                    </div>
                                                                </div>

                                                                {/* Ï†ÑÏ†Å ÌÖåÏù¥Î∏î */}
                                                                <div className="bg-slate-900 rounded-xl overflow-hidden shadow-inner">
                                                                    <table className="w-full text-[10px] text-center text-slate-400">
                                                                        <thead className="bg-slate-800 text-slate-500 font-bold uppercase">
                                                                            <tr>
                                                                                <th className="py-2">Date</th>
                                                                                <th>Dist</th>
                                                                                <th className="text-white">Rec</th>
                                                                                <th>Rank</th>
                                                                                <th className="text-red-400">S1F</th>
                                                                                <th className="text-blue-400">G1F</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody className="divide-y divide-slate-800 font-mono">
                                                                            {hist.map((v, i) => (
                                                                                <tr key={i}>
                                                                                    <td className="py-2 text-slate-500">{v.date}</td>
                                                                                    <td>{v.dist}</td>
                                                                                    <td className="text-yellow-400">{v.rec}</td>
                                                                                    <td className={v.rank?.startsWith('1/') ? 'text-white font-bold' : ''}>{v.rank}</td>
                                                                                    <td className="text-red-500">{v.s1f}</td>
                                                                                    <td className="text-blue-500">{v.g1f}</td>
                                                                                </tr>
                                                                            ))}
                                                                            {hist.length === 0 && <tr><td colSpan="6" className="py-4 text-slate-600">Í∏∞Î°ù ÏóÜÏùå</td></tr>}
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    <footer className="p-8 text-center border-t border-slate-100 bg-white">
                        <div className="text-[10px] font-black text-slate-300 uppercase tracking-[0.5em] italic">
                            Integrated Smart Racing Cloud Pro &copy; 2025 v7.0
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
