<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>경주마 상세 정보 조회 (JSON 파일 로드)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f3f4f6;
        }
        .main-header {
            background-color: #1e3a8a; /* A dark blue color similar to the screenshot */
        }
        .table-container {
            width: 100%;
            overflow-x: auto;
        }
        tr.selected-row {
            background-color: #dbeafe; /* Light blue to highlight selected row */
        }
        .horse-name-clickable {
            cursor: pointer;
            color: #1d4ed8;
            font-weight: 600;
        }
        .horse-name-clickable:hover {
            text-decoration: underline;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app" class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header Section -->
        <header class="main-header text-white p-6 rounded-lg shadow-lg mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 id="race-title" class="text-4xl font-bold"></h1>
                    <p id="race-details" class="text-lg opacity-90"></p>
                </div>
                <div class="text-right">
                    <p class="text-sm">총두수</p>
                    <p id="race-entries" class="text-3xl font-bold"></p>
                </div>
                <div id="race-time" class="text-6xl font-bold"></div>
            </div>
        </header>

        <!-- File Info Section -->
        <section class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-2">1. 출전 정보</h3>
                <p id="file-entry" class="text-sm text-gray-600 truncate"></p>
                <a href="#" class="text-sm text-blue-600 hover:underline">✓ 업로드 완료</a>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-2">2. 과거 기록</h3>
                <p id="file-record" class="text-sm text-gray-600 truncate"></p>
                <a href="#" class="text-sm text-blue-600 hover:underline">✓ 업로드 완료</a>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-2">3. 주행 스타일</h3>
                <p id="file-style" class="text-sm text-gray-600 truncate"></p>
                <a href="#" class="text-sm text-blue-600 hover:underline">✓ 업로드 완료</a>
            </div>
        </section>

        <!-- Main Horse List Table -->
        <section class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
            <div class="table-container">
                <table class="w-full text-sm text-center">
                    <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
                        <tr>
                            <th class="p-3">마번</th>
                            <th class="p-3 text-left">마명</th>
                            <th class="p-3">등급</th>
                            <th class="p-3">기수</th>
                            <th class="p-3">조교사</th>
                            <th class="p-3">부중</th>
                            <th class="p-3" colspan="3">주행스타일</th>
                            <th class="p-3">최근경주</th>
                            <th class="p-3">최고기록</th>
                            <th class="p-3">S1F</th>
                            <th class="p-3">G3F</th>
                            <th class="p-3">G1F</th>
                            <th class="p-3">레이팅</th>
                        </tr>
                    </thead>
                    <tbody id="horse-list-body" class="divide-y divide-gray-200">
                        <!-- Horse data will be populated here -->
                    </tbody>
                </table>
                 <div id="main-loader" class="loader"></div>
            </div>
        </section>

        <!-- Past Races Section (Initially Hidden) -->
        <section id="past-races-section" class="hidden">
            <h2 id="past-races-title" class="text-2xl font-bold mb-4"></h2>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="table-container">
                    <table class="w-full text-sm text-center">
                        <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
                            <tr>
                                <th class="p-3">경주일자</th>
                                <th class="p-3">경주부호</th>
                                <th class="p-3">등급</th>
                                <th class="p-3">거리</th>
                                <th class="p-3">기록</th>
                                <th class="p-3">S1F</th>
                                <th class="p-3">G3F</th>
                                <th class="p-3">G1F</th>
                                <th class="p-3">마체중</th>
                            </tr>
                        </thead>
                        <tbody id="past-races-body" class="divide-y divide-gray-200">
                            <!-- Past race data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    // 외부 JSON 파일을 불러옵니다. 파일명은 'race_data.json'으로 가정합니다.
    fetch('race_data.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('네트워크 응답이 올바르지 않습니다.');
            }
            return response.json();
        })
        .then(raceData => {
            // 로딩이 성공하면 로더를 숨깁니다.
            document.getElementById('main-loader').style.display = 'none';
            
            // JSON 데이터로 페이지를 렌더링하는 함수를 호출합니다.
            renderPage(raceData);
        })
        .catch(error => {
            console.error('JSON 파일 로딩 또는 파싱에 실패했습니다:', error);
            document.getElementById('horse-list-body').innerHTML = `<tr><td colspan="15" class="p-4 text-center text-red-500">데이터를 불러오는 데 실패했습니다. race_data.json 파일이 올바른 위치에 있는지 확인하세요.</td></tr>`;
            document.getElementById('main-loader').style.display = 'none';
        });
});

function renderPage(raceData) {
    // 1. Render static race info
    const { raceInfo, files, horses } = raceData;
    document.getElementById('race-title').textContent = `${raceInfo.location} ${raceInfo.raceNumber}`;
    document.getElementById('race-details').textContent = `${raceInfo.class}, ${raceInfo.distance}`;
    document.getElementById('race-entries').textContent = `${raceInfo.totalEntries}두`;
    document.getElementById('race-time').textContent = raceInfo.time;
    
    document.getElementById('file-entry').textContent = files.entryFile;
    document.getElementById('file-record').textContent = files.recordFile;
    document.getElementById('file-style').textContent = files.styleFile;

    // 2. Render main horse list
    const horseListBody = document.getElementById('horse-list-body');
    horseListBody.innerHTML = ''; // Clear loader or error message
    horses.forEach((horse, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="p-3">${horse.horseNumber}</td>
            <td class="p-3 text-left horse-name-clickable" data-index="${index}">${horse.horseName}</td>
            <td class="p-3">${horse.class}</td>
            <td class="p-3">${horse.jockey}</td>
            <td class="p-3">${horse.trainer}</td>
            <td class="p-3">${horse.weight}</td>
            <td class="p-3 text-xs">${horse.runningStyle.frontRunner?.raw || '-'}</td>
            <td class="p-3 text-xs">${horse.runningStyle.stalker?.raw || '-'}</td>
            <td class="p-3 text-xs">${horse.runningStyle.closer?.raw || '-'}</td>
            <td class="p-3 text-xs">${horse.records.recentRace}</td>
            <td class="p-3">${horse.records.bestTime}</td>
            <td class="p-3">${horse.sectionals.s1f.time}</td>
            <td class="p-3">${horse.sectionals.g3f.time}</td>
            <td class="p-3">${horse.sectionals.g1f.time}</td>
            <td class="p-3">${horse.rating}</td>
        `;
        horseListBody.appendChild(row);
    });

    // 3. Add click event listeners to horse names
    document.querySelectorAll('.horse-name-clickable').forEach(nameCell => {
        nameCell.addEventListener('click', (event) => {
            const index = event.target.dataset.index;
            const selectedHorse = horses[index];
            
            // Highlight selected row
            document.querySelectorAll('#horse-list-body tr').forEach(tr => tr.classList.remove('selected-row'));
            event.target.closest('tr').classList.add('selected-row');

            renderPastRaces(selectedHorse);
        });
    });
}

function renderPastRaces(horse) {
    const section = document.getElementById('past-races-section');
    const title = document.getElementById('past-races-title');
    const body = document.getElementById('past-races-body');

    title.textContent = `${horse.horseName} 과거기록`;
    body.innerHTML = ''; // Clear previous data

    if (horse.pastRaces && horse.pastRaces.length > 0) {
        horse.pastRaces.forEach(race => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="p-3">${race.raceDate}</td>
                <td class="p-3">${race.raceId}</td>
                <td class="p-3">${race.class}</td>
                <td class="p-3">${race.distance}m</td>
                <td class="p-3">${race.record}</td>
                <td class="p-3">${race.s1f}</td>
                <td class="p-3">${race.g3f}</td>
                <td class="p-3">${race.g1f}</td>
                <td class="p-3">${race.horseWeight}</td>
            `;
            body.appendChild(row);
        });
    } else {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="9" class="p-4 text-center text-gray-500">과거 경기 기록 데이터가 없습니다.</td>`;
        body.appendChild(row);
    }
    
    section.classList.remove('hidden');
}
</script>
</body>
</html>
